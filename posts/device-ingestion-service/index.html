<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Device Ingestion Service" /><meta property="og:locale" content="en" /><meta name="description" content="Absolutely! Let’s dive deeper into the Device Ingestion Service, which is a critical component of your system. This service is responsible for collecting data from your devices in real time and forwarding it to the rest of the system for processing and storage." /><meta property="og:description" content="Absolutely! Let’s dive deeper into the Device Ingestion Service, which is a critical component of your system. This service is responsible for collecting data from your devices in real time and forwarding it to the rest of the system for processing and storage." /><link rel="canonical" href="https://gitjmc.github.io/posts/device-ingestion-service/" /><meta property="og:url" content="https://gitjmc.github.io/posts/device-ingestion-service/" /><meta property="og:site_name" content="JMC-memo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-08T15:35:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Device Ingestion Service" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-02-22T08:39:38-05:00","datePublished":"2025-02-08T15:35:00-05:00","description":"Absolutely! Let’s dive deeper into the Device Ingestion Service, which is a critical component of your system. This service is responsible for collecting data from your devices in real time and forwarding it to the rest of the system for processing and storage.","headline":"Device Ingestion Service","mainEntityOfPage":{"@type":"WebPage","@id":"https://gitjmc.github.io/posts/device-ingestion-service/"},"url":"https://gitjmc.github.io/posts/device-ingestion-service/"}</script><title>Device Ingestion Service | JMC-memo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JMC-memo"><meta name="application-name" content="JMC-memo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://gitjmc.github.io/assets/img/favicons/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JMC-memo</a></div><div class="site-subtitle font-italic">À la demande de sisi</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/gitjmc" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Device Ingestion Service</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Device Ingestion Service</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Jerbi Mohamed Chamseddine</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1739046900" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-02-08 </em> </span> <span> Updated <em class="timeago" data-ts="1740231578" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-02-22 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="961 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p>Absolutely! Let’s dive deeper into the <strong>Device Ingestion Service</strong>, which is a critical component of your system. This service is responsible for collecting data from your devices in real time and forwarding it to the rest of the system for processing and storage.</p><hr /><h3 id="1-responsibilities-of-the-device-ingestion-service"><span class="mr-2"><strong>1. Responsibilities of the Device Ingestion Service</strong></span><a href="#1-responsibilities-of-the-device-ingestion-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><strong>Receive Data</strong>: Accept data from devices via protocols like MQTT, WebSocket, or HTTP.<li><strong>Validate Data</strong>: Ensure the incoming data is in the correct format and free of errors.<li><strong>Forward Data</strong>: Send the validated data to a message broker (e.g., Kafka, RabbitMQ) for further processing.<li><strong>Handle Device Authentication</strong>: Authenticate devices to ensure only authorized devices can send data.<li><strong>Scale for High Throughput</strong>: Handle a large number of devices and high data volumes.</ul><hr /><h3 id="2-key-features"><span class="mr-2"><strong>2. Key Features</strong></span><a href="#2-key-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><strong>Protocol Support</strong>: Support multiple communication protocols (e.g., MQTT, WebSocket, HTTP).<li><strong>Data Validation</strong>: Validate incoming data for format, type, and integrity.<li><strong>Authentication</strong>: Authenticate devices using API keys, certificates, or mutual TLS (mTLS).<li><strong>Scalability</strong>: Handle high throughput and scale horizontally as the number of devices grows.<li><strong>Fault Tolerance</strong>: Ensure data is not lost even if the service or downstream systems fail.</ul><hr /><h3 id="3-design-of-the-device-ingestion-service"><span class="mr-2"><strong>3. Design of the Device Ingestion Service</strong></span><a href="#3-design-of-the-device-ingestion-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Here’s how you can design the service:</p><h4 id="a-protocol-handlers"><span class="mr-2"><strong>a. Protocol Handlers</strong></span><a href="#a-protocol-handlers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><strong>MQTT Handler</strong>:<ul><li>Use an MQTT broker like <strong>Mosquitto</strong> or <strong>EMQX</strong>.<li>Devices publish data to specific topics (e.g., <code class="language-plaintext highlighter-rouge">devices/device-id/data</code>).<li>The service subscribes to these topics to receive data.</ul><li><strong>WebSocket Handler</strong>:<ul><li>Use a WebSocket server (e.g., <strong>Socket.IO</strong> or <strong>ws</strong> in Node.js).<li>Devices establish a WebSocket connection and send data in real time.</ul><li><strong>HTTP Handler</strong>:<ul><li>Use a REST API endpoint to accept HTTP POST requests from devices.<li>Devices send data as JSON payloads.</ul></ul><h4 id="b-data-validation"><span class="mr-2"><strong>b. Data Validation</strong></span><a href="#b-data-validation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>Validate the structure and content of incoming data.<li>Example validation checks:<ul><li>Required fields (e.g., <code class="language-plaintext highlighter-rouge">device_id</code>, <code class="language-plaintext highlighter-rouge">timestamp</code>, <code class="language-plaintext highlighter-rouge">sensor_value</code>).<li>Data types (e.g., <code class="language-plaintext highlighter-rouge">sensor_value</code> should be a number).<li>Range checks (e.g., <code class="language-plaintext highlighter-rouge">sensor_value</code> should be between 0 and 100).</ul></ul><h4 id="c-authentication"><span class="mr-2"><strong>c. Authentication</strong></span><a href="#c-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><strong>API Keys</strong>: Devices include an API key in their requests (e.g., in the HTTP header or MQTT topic).<li><strong>Certificates</strong>: Use mutual TLS (mTLS) to authenticate devices with client certificates.<li><strong>JWT</strong>: Devices send a signed JWT token with each request.</ul><h4 id="d-data-forwarding"><span class="mr-2"><strong>d. Data Forwarding</strong></span><a href="#d-data-forwarding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>Use a message broker like <strong>Apache Kafka</strong>, <strong>RabbitMQ</strong>, or <strong>Redis Pub/Sub</strong> to forward data to the <strong>Data Processing Service</strong>.<li>Example workflow:<ol><li>The service receives data from a device.<li>It validates and authenticates the data.<li>It publishes the data to a message broker topic (e.g., <code class="language-plaintext highlighter-rouge">device-data</code>).</ol></ul><h4 id="e-scalability"><span class="mr-2"><strong>e. Scalability</strong></span><a href="#e-scalability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>Use a load balancer (e.g., NGINX, HAProxy) to distribute traffic across multiple instances of the service.<li>Use a distributed message broker (e.g., Kafka) to handle high throughput.</ul><h4 id="f-fault-tolerance"><span class="mr-2"><strong>f. Fault Tolerance</strong></span><a href="#f-fault-tolerance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>Use persistent connections (e.g., WebSocket or MQTT) to ensure data is not lost during network interruptions.<li>Implement retries and acknowledgments when forwarding data to the message broker.</ul><hr /><h3 id="4-example-implementation"><span class="mr-2"><strong>4. Example Implementation</strong></span><a href="#4-example-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Here’s an example implementation of the <strong>Device Ingestion Service</strong> using <strong>Node.js</strong> and <strong>MQTT</strong>:</p><h4 id="a-mqtt-handler"><span class="mr-2"><strong>a. MQTT Handler</strong></span><a href="#a-mqtt-handler" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">mqtt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mqtt</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">mqtt</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="dl">'</span><span class="s1">mqtt://broker.example.com</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Subscribe to device topics</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">client</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="dl">'</span><span class="s1">devices/+/data</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Subscribed to device data topics</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Handle incoming messages</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">validateData</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Forward data to the message broker</span>
    <span class="nx">forwardToMessageBroker</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid data received:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Validate data</span>
<span class="kd">function</span> <span class="nx">validateData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">device_id</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">sensor_value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Forward data to Kafka</span>
<span class="kd">function</span> <span class="nx">forwardToMessageBroker</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Example: Send data to Kafka</span>
  <span class="kd">const</span> <span class="nx">kafka</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">kafka-node</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">Producer</span> <span class="o">=</span> <span class="nx">kafka</span><span class="p">.</span><span class="nx">Producer</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaClient</span><span class="p">({</span> <span class="na">kafkaHost</span><span class="p">:</span> <span class="dl">'</span><span class="s1">kafka.example.com:9092</span><span class="dl">'</span> <span class="p">});</span>
  <span class="kd">const</span> <span class="nx">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Producer</span><span class="p">(</span><span class="nx">client</span><span class="p">);</span>

  <span class="nx">producer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ready</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">[{</span> <span class="na">topic</span><span class="p">:</span> <span class="dl">'</span><span class="s1">device-data</span><span class="dl">'</span><span class="p">,</span> <span class="na">messages</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">}];</span>
    <span class="nx">producer</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error forwarding data to Kafka:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="b-websocket-handler"><span class="mr-2"><strong>b. WebSocket Handler</strong></span><a href="#b-websocket-handler" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="na">port</span><span class="p">:</span> <span class="mi">8080</span> <span class="p">});</span>

<span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">ws</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">validateData</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">forwardToMessageBroker</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid data received:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><h4 id="c-http-handler"><span class="mr-2"><strong>c. HTTP Handler</strong></span><a href="#c-http-handler" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/data</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">validateData</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">forwardToMessageBroker</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Data received</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid data</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">HTTP server listening on port 3000</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><hr /><h3 id="5-tools-and-libraries"><span class="mr-2"><strong>5. Tools and Libraries</strong></span><a href="#5-tools-and-libraries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>| <strong>Functionality</strong> | <strong>Tools/Libraries</strong> | |————————-|————————————————————————————-| | <strong>MQTT</strong> | Mosquitto, EMQX, <code class="language-plaintext highlighter-rouge">mqtt.js</code> (Node.js) | | <strong>WebSocket</strong> | <code class="language-plaintext highlighter-rouge">ws</code> (Node.js), Socket.IO | | <strong>HTTP</strong> | Express.js, FastAPI (Python), Spring Boot (Java) | | <strong>Message Broker</strong> | Apache Kafka, RabbitMQ, Redis Pub/Sub | | <strong>Authentication</strong> | JWT, OAuth 2.0, mutual TLS (mTLS) | | <strong>Data Validation</strong> | JSON Schema, Joi (Node.js), Pydantic (Python) |</p><hr /><h3 id="6-deployment-considerations"><span class="mr-2"><strong>6. Deployment Considerations</strong></span><a href="#6-deployment-considerations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><strong>Containerization</strong>: Package the service in a Docker container for easy deployment.<li><strong>Orchestration</strong>: Use Kubernetes to manage and scale the service.<li><strong>Monitoring</strong>: Monitor the service using Prometheus and Grafana.<li><strong>Load Balancing</strong>: Use NGINX or HAProxy to distribute traffic across multiple instances.</ul><hr /><h3 id="7-example-workflow"><span class="mr-2"><strong>7. Example Workflow</strong></span><a href="#7-example-workflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>A device sends data to the <strong>Device Ingestion Service</strong> via MQTT, WebSocket, or HTTP.<li>The service validates the data and authenticates the device.<li>The service forwards the data to a message broker (e.g., Kafka).<li>The <strong>Data Processing Service</strong> consumes the data from the message broker for further processing.</ol><hr /><p>If you’d like, I can help you dive deeper into any specific part of the implementation (e.g., MQTT setup, Kafka integration, or authentication). Let me know! 😊</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/architecture/'>Architecture</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/data/" class="post-tag no-text-decoration" >data</a> <a href="/tags/ingestion/" class="post-tag no-text-decoration" >ingestion</a> <a href="/tags/automation/" class="post-tag no-text-decoration" >automation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Device Ingestion Service - JMC-memo&amp;url=https://gitjmc.github.io/posts/device-ingestion-service/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Device Ingestion Service - JMC-memo&amp;u=https://gitjmc.github.io/posts/device-ingestion-service/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://gitjmc.github.io/posts/device-ingestion-service/&amp;text=Device Ingestion Service - JMC-memo" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://gitjmc.github.io/posts/device-ingestion-service/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Device Ingestion Service - JMC-memo&amp;url=https://gitjmc.github.io/posts/device-ingestion-service/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/secureFormQualtrics/">How to secure Form in Qualtrics</a><li><a href="/posts/mosquitto-tls/">Mosquitto with Docker Compose and Base Authentication & Let's Encrypt (DuckDNS)</a><li><a href="/posts/common-cli/">Common CLI on linux</a><li><a href="/posts/docker-install/">Install Docker on Deepin 20.x</a><li><a href="/posts/docker-install-ubuntu/">Install Docker on ubuntu and Deepin</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/tuto/">tuto</a> <a class="post-tag" href="/tags/angular/">angular</a> <a class="post-tag" href="/tags/dev/">dev</a> <a class="post-tag" href="/tags/access/">access</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/real-time/">real-time</a> <a class="post-tag" href="/tags/wireguard/">wireguard</a> <a class="post-tag" href="/tags/api/">api</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/docker-install/"><div class="card-body"> <em class="timeago small" data-ts="1645992180" > 2022-02-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Install Docker on Deepin 20.x</h3><div class="text-muted small"><p> Cet article montre comment peut-on installer docker dans Deepin1 version 20.x et plus. MAJ ‘2022-04-18’ Solution install Docker Prerequistes $ sudo apt-get update $ sudo apt install -y apt...</p></div></div></a></div><div class="card"> <a href="/posts/dockerize-jekyll/"><div class="card-body"> <em class="timeago small" data-ts="1649025600" > 2022-04-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dockerize Jekyll</h3><div class="text-muted small"><p> This post will guide you how to dockerize Jekyll. Prerequistes Docker installed; docker-compose.yaml version: &#39;3&#39; services: jekyll-serve: image: jekyll/jekyll:4.0 volumes: ...</p></div></div></a></div><div class="card"> <a href="/posts/dockerize-angular/"><div class="card-body"> <em class="timeago small" data-ts="1649041500" > 2022-04-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dockerize an Angular dev environment</h3><div class="text-muted small"><p> This post will guide you how to create an angular dev environment in docker. Contexte Pour ne pas installer sur son poste node, angular etc … Aussi avoir la possibilt/ de travailler avec dif...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/designing-a-microservices-architecture-and-system-architecture/" class="btn btn-outline-primary" prompt="Older"><p>Designing a microservices architecture and system architecture</p></a> <a href="/posts/simulating-iot-devices/" class="btn btn-outline-primary" prompt="Newer"><p>Simulating IoT devices (sensors, actuators, etc.)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Jerbi Mohamed Chamseddine</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/tuto/">tuto</a> <a class="post-tag" href="/tags/angular/">angular</a> <a class="post-tag" href="/tags/dev/">dev</a> <a class="post-tag" href="/tags/access/">access</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/real-time/">real-time</a> <a class="post-tag" href="/tags/wireguard/">wireguard</a> <a class="post-tag" href="/tags/api/">api</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-REJ95ZFTQX"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-REJ95ZFTQX'); }); </script>
