<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="How the service can authenticates the device" /><meta property="og:locale" content="en" /><meta name="description" content="Device authentication is a critical part of the Device Ingestion Service to ensure that only authorized devices can send data to your system. There are several methods to authenticate devices, each with its own pros and cons. Below, Iâ€™ll explain the most common approaches and provide implementation details." /><meta property="og:description" content="Device authentication is a critical part of the Device Ingestion Service to ensure that only authorized devices can send data to your system. There are several methods to authenticate devices, each with its own pros and cons. Below, Iâ€™ll explain the most common approaches and provide implementation details." /><link rel="canonical" href="https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/" /><meta property="og:url" content="https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/" /><meta property="og:site_name" content="JMC-memo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-09T21:35:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How the service can authenticates the device" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-02-22T08:39:38-05:00","datePublished":"2025-02-09T21:35:00-05:00","description":"Device authentication is a critical part of the Device Ingestion Service to ensure that only authorized devices can send data to your system. There are several methods to authenticate devices, each with its own pros and cons. Below, Iâ€™ll explain the most common approaches and provide implementation details.","headline":"How the service can authenticates the device","mainEntityOfPage":{"@type":"WebPage","@id":"https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/"},"url":"https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/"}</script><title>How the service can authenticates the device | JMC-memo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JMC-memo"><meta name="application-name" content="JMC-memo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://gitjmc.github.io/assets/img/favicons/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JMC-memo</a></div><div class="site-subtitle font-italic">Ã€ la demande de sisi</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/gitjmc" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How the service can authenticates the device</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How the service can authenticates the device</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Jerbi Mohamed Chamseddine</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1739154900" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-02-09 </em> </span> <span> Updated <em class="timeago" data-ts="1740231578" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-02-22 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="945 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p>Device authentication is a critical part of the <strong>Device Ingestion Service</strong> to ensure that only authorized devices can send data to your system. There are several methods to authenticate devices, each with its own pros and cons. Below, Iâ€™ll explain the most common approaches and provide implementation details.</p><hr /><h3 id="1-authentication-methods-for-devices"><span class="mr-2"><strong>1. Authentication Methods for Devices</strong></span><a href="#1-authentication-methods-for-devices" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="a-api-keys"><span class="mr-2"><strong>a. API Keys</strong></span><a href="#a-api-keys" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><strong>How It Works</strong>:<ul><li>Each device is assigned a unique API key.<li>The device includes the API key in its requests (e.g., in the HTTP header, MQTT topic, or WebSocket message).<li>The service validates the API key against a database or in-memory store.</ul><li><strong>Pros</strong>:<ul><li>Simple to implement.<li>Lightweight and fast.</ul><li><strong>Cons</strong>:<ul><li>API keys can be compromised if not transmitted securely (e.g., over HTTPS or TLS).<li>Requires secure storage and rotation of keys.</ul></ul><h4 id="b-mutual-tls-mtls"><span class="mr-2"><strong>b. Mutual TLS (mTLS)</strong></span><a href="#b-mutual-tls-mtls" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><strong>How It Works</strong>:<ul><li>Each device has a client certificate issued by a trusted Certificate Authority (CA).<li>The device presents its certificate when establishing a connection (e.g., MQTT over TLS or HTTPS).<li>The service validates the certificate and authenticates the device.</ul><li><strong>Pros</strong>:<ul><li>Highly secure.<li>No need to transmit sensitive credentials (e.g., API keys) over the network.</ul><li><strong>Cons</strong>:<ul><li>Requires certificate management (issuance, renewal, revocation).<li>Adds complexity to the setup.</ul></ul><h4 id="c-json-web-tokens-jwt"><span class="mr-2"><strong>c. JSON Web Tokens (JWT)</strong></span><a href="#c-json-web-tokens-jwt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><strong>How It Works</strong>:<ul><li>Devices are issued a JWT (signed by a private key) during registration.<li>The device includes the JWT in its requests (e.g., in the HTTP header or MQTT payload).<li>The service validates the JWT using the corresponding public key.</ul><li><strong>Pros</strong>:<ul><li>Stateless and scalable.<li>Can include additional claims (e.g., device permissions, expiration).</ul><li><strong>Cons</strong>:<ul><li>Requires secure key management.<li>JWTs can be large, increasing network overhead.</ul></ul><h4 id="d-oauth-20-device-flow"><span class="mr-2"><strong>d. OAuth 2.0 (Device Flow)</strong></span><a href="#d-oauth-20-device-flow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><strong>How It Works</strong>:<ul><li>Devices use the OAuth 2.0 Device Flow to obtain an access token.<li>The device includes the access token in its requests.<li>The service validates the token with the OAuth 2.0 authorization server.</ul><li><strong>Pros</strong>:<ul><li>Standardized and widely used.<li>Supports fine-grained access control.</ul><li><strong>Cons</strong>:<ul><li>More complex to implement.<li>Requires an OAuth 2.0 authorization server.</ul></ul><hr /><h3 id="2-implementation-examples"><span class="mr-2"><strong>2. Implementation Examples</strong></span><a href="#2-implementation-examples" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="a-api-key-authentication"><span class="mr-2"><strong>a. API Key Authentication</strong></span><a href="#a-api-key-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Hereâ€™s how you can implement API key authentication in the <strong>Device Ingestion Service</strong>:</p><h5 id="http-example-nodejs-with-express"><span class="mr-2"><strong>HTTP Example (Node.js with Express)</strong>:</span><a href="#http-example-nodejs-with-express" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="c1">// In-memory store for API keys (replace with a database in production)</span>
<span class="kd">const</span> <span class="nx">validApiKeys</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Set</span><span class="p">([</span><span class="dl">'</span><span class="s1">device1-api-key</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">device2-api-key</span><span class="dl">'</span><span class="p">]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/data</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">x-api-key</span><span class="dl">'</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">apiKey</span> <span class="o">||</span> <span class="o">!</span><span class="nx">validApiKeys</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">apiKey</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unauthorized</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">validateData</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">forwardToMessageBroker</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Data received</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid data</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">HTTP server listening on port 3000</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><h5 id="mqtt-example-nodejs-with-mqttjs"><span class="mr-2"><strong>MQTT Example (Node.js with <code class="language-plaintext highlighter-rouge"><span class="mr-2">mqtt.js</code>)</strong>:</span><a href="#mqtt-example-nodejs-with-mqttjs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">mqtt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mqtt</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">mqtt</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="dl">'</span><span class="s1">mqtt://broker.example.com</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// In-memory store for API keys (replace with a database in production)</span>
<span class="kd">const</span> <span class="nx">validApiKeys</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Set</span><span class="p">([</span><span class="dl">'</span><span class="s1">device1-api-key</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">device2-api-key</span><span class="dl">'</span><span class="p">]);</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">client</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="dl">'</span><span class="s1">devices/+/data</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Subscribed to device data topics</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="kd">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">apiKey</span><span class="p">;</span> <span class="c1">// API key included in the payload</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">apiKey</span> <span class="o">||</span> <span class="o">!</span><span class="nx">validApiKeys</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">apiKey</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unauthorized device:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">device_id</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">validateData</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">forwardToMessageBroker</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid data received:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><hr /><h4 id="b-mutual-tls-mtls-authentication"><span class="mr-2"><strong>b. Mutual TLS (mTLS) Authentication</strong></span><a href="#b-mutual-tls-mtls-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Hereâ€™s how you can implement mTLS for device authentication:</p><h5 id="mqtt-with-mtls-mosquitto-broker"><span class="mr-2"><strong>MQTT with mTLS (Mosquitto Broker)</strong>:</span><a href="#mqtt-with-mtls-mosquitto-broker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><ol><li>Generate certificates for the CA, server, and devices:<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c"># Generate CA certificate</span>
openssl req <span class="nt">-new</span> <span class="nt">-x509</span> <span class="nt">-days</span> 365 <span class="nt">-extensions</span> v3_ca <span class="nt">-keyout</span> ca.key <span class="nt">-out</span> ca.crt

<span class="c"># Generate server certificate</span>
openssl genrsa <span class="nt">-out</span> server.key 2048
openssl req <span class="nt">-new</span> <span class="nt">-out</span> server.csr <span class="nt">-key</span> server.key
openssl x509 <span class="nt">-req</span> <span class="nt">-in</span> server.csr <span class="nt">-CA</span> ca.crt <span class="nt">-CAkey</span> ca.key <span class="nt">-CAcreateserial</span> <span class="nt">-out</span> server.crt <span class="nt">-days</span> 365

<span class="c"># Generate device certificate</span>
openssl genrsa <span class="nt">-out</span> device1.key 2048
openssl req <span class="nt">-new</span> <span class="nt">-out</span> device1.csr <span class="nt">-key</span> device1.key
openssl x509 <span class="nt">-req</span> <span class="nt">-in</span> device1.csr <span class="nt">-CA</span> ca.crt <span class="nt">-CAkey</span> ca.key <span class="nt">-CAcreateserial</span> <span class="nt">-out</span> device1.crt <span class="nt">-days</span> 365
</pre></table></code></div></div><li>Configure the Mosquitto broker to use mTLS:<div class="language-ini highlighter-rouge"><div class="code-header"> <span data-label-text="Ini"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># mosquitto.conf
</span><span class="err">listener</span> <span class="err">8883</span>
<span class="err">cafile</span> <span class="err">/path/to/ca.crt</span>
<span class="err">certfile</span> <span class="err">/path/to/server.crt</span>
<span class="err">keyfile</span> <span class="err">/path/to/server.key</span>
<span class="err">require_certificate</span> <span class="err">true</span>
</pre></table></code></div></div><li>Devices connect to the broker using their client certificates:<div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">mqtt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mqtt</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">mqtt</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="dl">'</span><span class="s1">mqtts://broker.example.com:8883</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">key</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">/path/to/device1.key</span><span class="dl">'</span><span class="p">),</span>
  <span class="na">cert</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">/path/to/device1.crt</span><span class="dl">'</span><span class="p">),</span>
  <span class="na">ca</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">/path/to/ca.crt</span><span class="dl">'</span><span class="p">),</span>
  <span class="na">rejectUnauthorized</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">client</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="dl">'</span><span class="s1">devices/device1/data</span><span class="dl">'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">sensor_value</span><span class="p">:</span> <span class="mi">25</span> <span class="p">}));</span>
<span class="p">});</span>
</pre></table></code></div></div></ol><hr /><h4 id="c-jwt-authentication"><span class="mr-2"><strong>c. JWT Authentication</strong></span><a href="#c-jwt-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Hereâ€™s how you can implement JWT authentication:</p><h5 id="http-example-nodejs-with-express-and-jsonwebtoken"><span class="mr-2"><strong>HTTP Example (Node.js with Express and <code class="language-plaintext highlighter-rouge"><span class="mr-2">jsonwebtoken</code>)</strong>:</span><a href="#http-example-nodejs-with-express-and-jsonwebtoken" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">jsonwebtoken</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="kd">const</span> <span class="nx">SECRET_KEY</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">your-secret-key</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/data</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">authorization</span><span class="dl">'</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unauthorized</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">decoded</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">SECRET_KEY</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">deviceId</span> <span class="o">=</span> <span class="nx">decoded</span><span class="p">.</span><span class="nx">deviceId</span><span class="p">;</span> <span class="c1">// Extract device ID from the token</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">validateData</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">forwardToMessageBroker</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Data received</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid data</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid token</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">HTTP server listening on port 3000</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><hr /><h3 id="3-choosing-the-right-method"><span class="mr-2"><strong>3. Choosing the Right Method</strong></span><a href="#3-choosing-the-right-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><strong>For simplicity</strong>: Use <strong>API keys</strong>.<li><strong>For high security</strong>: Use <strong>mTLS</strong>.<li><strong>For scalability and flexibility</strong>: Use <strong>JWT</strong> or <strong>OAuth 2.0</strong>.</ul><hr /><p>If youâ€™d like, I can help you implement any of these methods in your system or provide more details on a specific approach. Let me know! ðŸ˜Š</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/architecture/'>Architecture</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/authentication/" class="post-tag no-text-decoration" >authentication</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How the service can authenticates the device - JMC-memo&amp;url=https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How the service can authenticates the device - JMC-memo&amp;u=https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/&amp;text=How the service can authenticates the device - JMC-memo" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=How the service can authenticates the device - JMC-memo&amp;url=https://gitjmc.github.io/posts/how-the-service-can-authenticates-the-device/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/esp32/">ESP 32</a><li><a href="/posts/iot-project/">Iot Project with ESP 32</a><li><a href="/posts/secureFormQualtrics/">How to secure Form in Qualtrics</a><li><a href="/posts/mosquitto-tls/">Mosquitto with Docker Compose and Base Authentication & Let's Encrypt (DuckDNS)</a><li><a href="/posts/docker-install/">Install Docker on Deepin 20.x</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/tuto/">tuto</a> <a class="post-tag" href="/tags/angular/">angular</a> <a class="post-tag" href="/tags/dev/">dev</a> <a class="post-tag" href="/tags/access/">access</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/real-time/">real-time</a> <a class="post-tag" href="/tags/wireguard/">wireguard</a> <a class="post-tag" href="/tags/api/">api</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mes-liens-utiles/"><div class="card-body"> <em class="timeago small" data-ts="1646574360" > 2022-03-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mes liens utiles</h3><div class="text-muted small"><p> Ma liste des liens qui pourront mâ€™Ãªtre utiles â€¦\o/â€¦ Cette page contient des liens que jâ€™ai rencontrÃ© qq part de partout â€¦ Liste des liens Ouitl de documentation en ligne json editor - https:...</p></div></div></a></div><div class="card"> <a href="/posts/facebookl-manage-access/"><div class="card-body"> <em class="timeago small" data-ts="1735950900" > 2025-01-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Facebook access management in large enterprise with multiple accounts</h3><div class="text-muted small"><p> Yes, if an organization has multiple Facebook Pages (or other Meta assets like Instagram accounts or ad accounts), employees can access them through SSO (Single Sign-On). However, there are some im...</p></div></div></a></div><div class="card"> <a href="/posts/facebook-access-scim-sso/"><div class="card-body"> <em class="timeago small" data-ts="1736210100" > 2025-01-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Manage Access to Facebook throw SSO and protocl SCIM</h3><div class="text-muted small"><p> Yes, it is possible to access Facebook (and other Meta platforms like Instagram and WhatsApp) through enterprise Single Sign-On (SSO) configuration and the SCIM (System for Cross-domain Identity Ma...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/how-mutual-TLS-(mTLS)-works/" class="btn btn-outline-primary" prompt="Older"><p>How Mutual TLS (mTLS) works</p></a> <a href="/posts/SSE/" class="btn btn-outline-primary" prompt="Newer"><p>Server-Sent Events (SSE)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2025 <a href="https://twitter.com/username">Jerbi Mohamed Chamseddine</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/tuto/">tuto</a> <a class="post-tag" href="/tags/angular/">angular</a> <a class="post-tag" href="/tags/dev/">dev</a> <a class="post-tag" href="/tags/access/">access</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/real-time/">real-time</a> <a class="post-tag" href="/tags/wireguard/">wireguard</a> <a class="post-tag" href="/tags/api/">api</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-REJ95ZFTQX"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-REJ95ZFTQX'); }); </script>
